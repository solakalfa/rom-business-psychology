---
// src/components/Drawer.astro
---

<div class="drawer-overlay" id="drawerOverlay"></div>

<div class="drawer font-['Poppins']" id="drawer">
  <div class="drawer-container">
    <button class="drawer-close" id="drawerClose" aria-label="Close menu">Ã—</button>

    <div class="drawer-grid">
      <nav class="nav-column">
        <span class="nav-label">Teams</span>
        <div class="nav-sublinks">
          <a href="/teams-counseling" class="nav-sublink highlight-sub">Overview</a>
          <a href="/team-building-and-development" class="nav-sublink">Building & Development</a>
          <a href="/management-skills" class="nav-sublink">Management Skills</a>
          <a href="/mentoring-task-force" class="nav-sublink">Mentoring Task Force</a>
        </div>
        
        <div class="nav-group-spacing">
          <span class="nav-label">Individuals</span>
          <div class="nav-sublinks">
            <a href="/personal-counseling" class="nav-sublink highlight-sub">Overview</a>
            <a href="/executive-coaching" class="nav-sublink">Executive Coaching</a>
            <a href="/career-development" class="nav-sublink">Career Development</a>
            <a href="/emotional-therapy" class="nav-sublink">Emotional Therapy</a>
          </div>
        </div>
      </nav>

      <nav class="nav-column">
        <span class="nav-label">About Us</span>
        <div class="nav-sublinks">
          <a href="/" class="nav-sublink highlight-sub">Home</a>
          <a href="/clients" class="nav-sublink">Our Clients</a>
          <a href="/team" class="nav-sublink">Meet the Family</a>
          <a href="/publications" class="nav-sublink">Publications</a>
        </div>
      </nav>

      <aside class="nav-column">
        <div class="contact-box">
          <div class="contact-header">
            <h4 class="contact-title">Get in Touch</h4>
            <a href="https://www.linkedin.com/in/eldad-rom-727836/" target="_blank" class="linkedin-link">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
          </div>
          <div class="contact-quick">
            <a href="tel:+972528152233">ğŸ“ +972 52-815-2233</a>
            <a href="mailto:info@rompsyc.com">âœ‰ï¸ info@rompsyc.com</a>
          </div>
          <form id="drawer-exclusive-form" class="compact-form">
            <input type="hidden" name="access_key" value="a4820d70-9146-4472-8991-86089ba18989" />
            <input type="email" name="email" placeholder="Email" required />
            <textarea name="message" placeholder="Message" rows="2" required></textarea>
            <button type="submit" id="drawer-exclusive-send">Send</button>
          </form>
          <div id="drawer-exclusive-success" class="hidden success-msg">âœ“ Sent!</div>
        </div>
      </aside>
    </div>
    
    <p class="drawer-copyright">ROM PSYC â€¢ 2026</p>
  </div>
</div>

<style>
  .drawer-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); opacity: 0; visibility: hidden; transition: 0.4s; z-index: 280; }
  .drawer-overlay.open { opacity: 1; visibility: visible; }

  .drawer { position: fixed; top: 0; right: -100%; width: 100vw; height: 100vh; background: #0f172a; z-index: 300; transition: right 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
  .drawer.open { right: 0 !important; }

  .drawer-container {
    max-width: 896px; /* ×ª×•×× ×‘×“×™×•×§ ×œ-Header */
    margin: 0 auto;
    padding: 140px 20px 60px; /* ×™×™×©×•×¨ ×¤×“×™× ×’ ×œ×œ×•×’×• (20px) */
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .drawer-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1.2fr;
    gap: 40px;
    align-items: start; /* ×™×™×©×•×¨ ×›×œ ×”×˜×•×¨×™× ×œ×”×ª×—×œ×” (××•×ª×• ×’×•×‘×”) */
  }

  .nav-column { display: flex; flex-direction: column; }
  .nav-group-spacing { margin-top: 40px; }

  .nav-label {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.25em;
    color: #22d3ee;
    font-weight: 800;
    display: block;
    margin-bottom: 22px;
  }

  .nav-sublinks {
    border-left: 1px solid rgba(34, 211, 238, 0.3);
    padding-left: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .nav-sublink { color: rgba(255,255,255,0.45); text-decoration: none; font-size: 16.5px; transition: 0.2s; }
  .nav-sublink:hover { color: #22d3ee; }
  .nav-sublink.highlight-sub { color: rgba(255,255,255,0.95); font-weight: 600; }

  .contact-box { background: rgba(255,255,255,0.03); padding: 28px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.08); }
  .contact-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
  .contact-title { color: white; font-size: 16px; font-weight: 600; margin: 0; }
  .linkedin-link { color: #22d3ee; opacity: 0.8; transition: 0.3s; }
  .linkedin-link:hover { opacity: 1; transform: scale(1.1); }
  
  .contact-quick { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; font-size: 14px; }
  .contact-quick a { color: #22d3ee; text-decoration: none; }

  .compact-form { display: flex; flex-direction: column; gap: 10px; }
  .compact-form input, .compact-form textarea { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 12px; color: white; border-radius: 10px; font-size: 14px; outline: none; }
  .compact-form button { background: #22d3ee; color: #0f172a; padding: 12px; border-radius: 10px; font-weight: 700; border: none; cursor: pointer; transition: 0.3s; }
  .compact-form button:hover { background: white; }

  .success-msg { color: #22d3ee; font-weight: bold; text-align: center; margin-top: 15px; }
  .drawer-copyright { color: rgba(255,255,255,0.15); font-size: 11px; margin-top: 60px; text-align: center; }
  .drawer-close { position: absolute; top: 35px; right: 30px; font-size: 36px; color: white; background: none; border: none; cursor: pointer; }

  @media (max-width: 850px) {
    .drawer-grid { grid-template-columns: 1fr; gap: 40px; overflow-y: auto; }
    .drawer-container { padding-top: 100px; justify-content: flex-start; }
    .nav-group-spacing { margin-top: 30px; }
  }
</style>

<script>
  const drawer = document.getElementById("drawer");
  const overlay = document.getElementById("drawerOverlay");
  const closeBtn = document.getElementById("drawerClose");
  const exclusiveForm = document.getElementById("drawer-exclusive-form") as HTMLFormElement;
  const exclusiveBtn = document.getElementById("drawer-exclusive-send") as HTMLButtonElement;
  const exclusiveSuccess = document.getElementById("drawer-exclusive-success");

  function openDrawer() {
    drawer?.classList.add("open");
    overlay?.classList.add("open");
    document.body.style.overflow = "hidden";
    window.dispatchEvent(new CustomEvent("menuStateChanged", { detail: { isOpen: true } }));
  }

  function closeDrawer() {
    drawer?.classList.remove("open");
    overlay?.classList.remove("open");
    document.body.style.overflow = "";
    window.dispatchEvent(new CustomEvent("menuStateChanged", { detail: { isOpen: false } }));
  }

  exclusiveForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (exclusiveBtn) { exclusiveBtn.disabled = true; exclusiveBtn.textContent = "Sending..."; }
    try {
      const formData = new FormData(exclusiveForm);
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json", "Accept": "application/json" },
        body: JSON.stringify(Object.fromEntries(formData)),
      });
      if (response.ok) { exclusiveForm.classList.add("hidden"); exclusiveSuccess?.classList.remove("hidden"); }
    } catch (err) { if (exclusiveBtn) { exclusiveBtn.disabled = false; exclusiveBtn.textContent = "Error"; } }
  });

  window.addEventListener("toggleMenu", () => drawer?.classList.contains("open") ? closeDrawer() : openDrawer());
  closeBtn?.addEventListener("click", closeDrawer);
  overlay?.addEventListener("click", closeDrawer);
</script>