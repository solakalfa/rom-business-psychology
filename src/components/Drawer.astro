---
// src/components/Drawer.astro
---

<div class="drawer-overlay" id="drawerOverlay"></div>

<div class="drawer font-['Poppins']" id="drawer">
  <div class="drawer-container">
    <button class="drawer-close" id="drawerClose" aria-label="Close menu">√ó</button>

    <div class="drawer-grid">
      <nav class="nav-services">
        <div class="nav-group">
          <a href="/teams-counseling" class="nav-link-main">Teams</a>
          <div class="nav-sublinks">
            <a href="/team-building-and-development" class="nav-sublink">Building & Development</a>
            <a href="/management-skills" class="nav-sublink">Management Skills</a>
            <a href="/mentoring-task-force" class="nav-sublink">Mentoring Task Force</a>
          </div>
        </div>

        <div class="nav-group">
          <a href="/personal-counseling" class="nav-link-main">People</a>
          <div class="nav-sublinks">
            <a href="/executive-coaching" class="nav-sublink">Executive Coaching</a>
            <a href="/career-development" class="nav-sublink">Career Development</a>
            <a href="/emotional-therapy" class="nav-sublink">Emotional Therapy</a>
          </div>
        </div>
      </nav>

      <nav class="nav-site">
        <a href="/" class="nav-link-main highlight">Home</a>
        <a href="/clients" class="nav-link-main small">Our Clients</a>
        <a href="/team" class="nav-link-main small">Meet the Family</a>
        <a href="/publications" class="nav-link-main small">Publications</a>
        <a href="/research" class="nav-link-main small">Research</a>
      </nav>

      <aside class="drawer-contact">
        <div class="contact-box">
          <h4 class="contact-title">Get in Touch</h4>
          <div class="contact-quick">
            <a href="tel:+972528152233">üìû +972 52-815-2233</a>
            <a href="mailto:info@rompsyc.com">‚úâÔ∏è info@rompsyc.com</a>
          </div>

          <form id="drawer-exclusive-form" class="compact-form">
            <input type="hidden" name="access_key" value="a4820d70-9146-4472-8991-86089ba18989" />
            <input type="email" name="email" placeholder="Email" required />
            <textarea name="message" placeholder="Message" rows="2" required></textarea>
            <button type="submit" id="drawer-exclusive-send">Send</button>
          </form>
          <div id="drawer-exclusive-success" class="hidden success-msg">‚úì Sent!</div>
        </div>
      </aside>
    </div>
    
    <p class="drawer-copyright">ROM PSYC ‚Ä¢ 2026</p>
  </div>
</div>

<style>
  .drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.7);
    backdrop-filter: blur(8px);
    opacity: 0;
    visibility: hidden;
    transition: 0.4s;
    z-index: 280; /* ◊û◊¢◊ú ◊î◊î◊ì◊® */
  }
  .drawer-overlay.open { opacity: 1; visibility: visible; }

  .drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100vw;
    height: 100vh;
    background: #0f172a;
    z-index: 300; /* ◊û◊¢◊ú ◊î◊õ◊ú */
    transition: right 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .drawer.open { right: 0 !important; }

  .drawer-container {
    max-width: 896px;
    margin: 0 auto;
    padding: 40px 24px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center; /* Valign Middle */
  }

  .drawer-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1.2fr;
    gap: 30px;
  }

  .nav-link-main {
    font-size: 22px;
    color: white;
    text-decoration: none;
    font-weight: 600;
    display: block;
    margin-bottom: 12px;
  }
  .nav-link-main.highlight { color: #22d3ee; margin-bottom: 20px; }
  .nav-link-main.small { font-size: 17px; margin-bottom: 12px; font-weight: 500; opacity: 0.9; }

  .nav-sublinks {
    border-left: 1px solid rgba(34, 211, 238, 0.3);
    padding-left: 15px;
    margin-bottom: 25px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .nav-sublink { color: rgba(255,255,255,0.4); text-decoration: none; font-size: 14px; transition: 0.2s; }
  .nav-sublink:hover { color: #22d3ee; }

  .contact-box {
    background: rgba(255,255,255,0.03);
    padding: 24px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .contact-title { color: white; margin-bottom: 12px; font-size: 15px; font-weight: 600; }
  .contact-quick { display: flex; flex-direction: column; gap: 5px; margin-bottom: 15px; font-size: 13px; }
  .contact-quick a { color: #22d3ee; text-decoration: none; }

  .compact-form { display: flex; flex-direction: column; gap: 8px; }
  .compact-form input, .compact-form textarea {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 10px;
    color: white;
    border-radius: 8px;
    font-size: 13px;
    outline: none;
  }
  .compact-form button {
    background: #22d3ee;
    color: #0f172a;
    padding: 10px;
    border-radius: 8px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  .compact-form button:hover { background: white; }

  .success-msg { color: #22d3ee; font-weight: bold; text-align: center; margin-top: 10px; font-size: 14px; }
  .drawer-copyright { color: rgba(255,255,255,0.2); font-size: 11px; margin-top: 40px; text-align: center; }
  .drawer-close { position: absolute; top: 30px; right: 24px; font-size: 32px; color: white; background: none; border: none; cursor: pointer; }

  @media (max-width: 800px) {
    .drawer-grid { grid-template-columns: 1fr; gap: 25px; overflow-y: auto; }
    .nav-sublinks { margin-bottom: 10px; }
    .drawer-container { padding-top: 80px; justify-content: flex-start; }
  }
</style>

<script>
  const drawer = document.getElementById("drawer");
  const overlay = document.getElementById("drawerOverlay");
  const closeBtn = document.getElementById("drawerClose");
  
  // ◊©◊ô◊û◊ï◊© ◊ë-IDs ◊î◊ô◊ô◊ó◊ï◊ì◊ô◊ô◊ù ◊©◊î◊í◊ì◊®◊†◊ï ◊ú◊û◊¢◊ú◊î
  const exclusiveForm = document.getElementById("drawer-exclusive-form") as HTMLFormElement;
  const exclusiveBtn = document.getElementById("drawer-exclusive-send") as HTMLButtonElement;
  const exclusiveSuccess = document.getElementById("drawer-exclusive-success");

  function openDrawer() {
    drawer?.classList.add("open");
    overlay?.classList.add("open");
    document.body.style.overflow = "hidden";
    window.dispatchEvent(new CustomEvent("menuStateChanged", { detail: { isOpen: true } }));
  }

  function closeDrawer() {
    drawer?.classList.remove("open");
    overlay?.classList.remove("open");
    document.body.style.overflow = "";
    window.dispatchEvent(new CustomEvent("menuStateChanged", { detail: { isOpen: false } }));
  }

  // ◊ú◊ï◊í◊ô◊ß◊™ ◊û◊©◊ú◊ï◊ó ◊û◊ë◊ï◊ì◊ì◊™ ◊ú◊û◊í◊ô◊®◊î ◊ë◊ú◊ë◊ì
  exclusiveForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (exclusiveBtn) {
      exclusiveBtn.disabled = true;
      exclusiveBtn.textContent = "Sending...";
    }

    try {
      const formData = new FormData(exclusiveForm);
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json", "Accept": "application/json" },
        body: JSON.stringify(Object.fromEntries(formData)),
      });

      if (response.ok) {
        exclusiveForm.classList.add("hidden");
        exclusiveSuccess?.classList.remove("hidden");
      } else {
        throw new Error("Form submission failed");
      }
    } catch (err) {
      if (exclusiveBtn) {
        exclusiveBtn.disabled = false;
        exclusiveBtn.textContent = "Error - Try Again";
      }
    }
  });

  window.addEventListener("toggleMenu", () => drawer?.classList.contains("open") ? closeDrawer() : openDrawer());
  closeBtn?.addEventListener("click", closeDrawer);
  overlay?.addEventListener("click", closeDrawer);
</script>